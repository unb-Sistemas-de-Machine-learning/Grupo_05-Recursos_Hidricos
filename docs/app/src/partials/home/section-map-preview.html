<!-- /src/partials/home/section-map-preview.html -->
<section id="map-preview" class="w-full">
  <div class="w-full max-w-[1358px] mx-auto px-5 sm:px-6 lg:px-10 py-10">
    <div class="flex items-end justify-between gap-4 mb-5">
      <div>
        <h2
          class="text-2xl sm:text-3xl font-extrabold tracking-tight text-[#031E21] dark:text-white"
          data-i18n="Map.title"
        >
          Mapa & Forecast
        </h2>

        <!-- Explicação rápida do que é mostrado -->
        <p
          class="mt-1 text-gray-600 dark:text-gray-300 text-sm"
          data-i18n="Map.subtitle"
        >
          Selecione a região para ver o mapa e a tendência em 7 dias. As linhas
          indicam a variação ao longo da semana; os valores ao lado mostram o
          último ponto disponível.
        </p>
      </div>

      <!-- seletor de região -->
      <div class="relative">
        <button id="region-toggle"
          class="inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-semibold
                 border border-gray-200 dark:border-white/15 bg-white/70 dark:bg-white/10
                 text-gray-800 dark:text-gray-100 hover:bg-white dark:hover:bg-white/5">
          <span id="region-current" data-i18n="Map.region.df">DF — Geral</span>
          <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M5.5 7.5l4.5 4.5 4.5-4.5"/></svg>
        </button>
        <div id="region-menu"
             class="hidden absolute right-0 mt-2 w-56 rounded-xl border border-gray-200 dark:border-white/15
                    bg-white/95 dark:bg-[#0E1A2B]/95 backdrop-blur-xl shadow-lg overflow-hidden z-10">
          <button class="w-full text-left px-4 py-2 hover:bg-gray-50 dark:hover:bg-white/10" data-region="DF — Geral" data-i18n="Map.region.df">DF — Geral</button>
          <button class="w-full text-left px-4 py-2 hover:bg-gray-50 dark:hover:bg-white/10" data-region="Bacia Descoberto" data-i18n="Map.region.desc">Bacia Descoberto</button>
          <button class="w-full text-left px-4 py-2 hover:bg-gray-50 dark:hover:bg-white/10" data-region="Bacia Paranoá" data-i18n="Map.region.paranoa">Bacia Paranoá</button>
          <button class="w-full text-left px-4 py-2 hover:bg-gray-50 dark:hover:bg-white/10" data-region="Bacia São Bartolomeu" data-i18n="Map.region.sb">Bacia São Bartolomeu</button>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- card do mapa -->
      <div class="lg:col-span-8">
        <div class="rounded-3xl overflow-hidden ring-1 ring-black/5 dark:ring-white/10 bg-white/60 dark:bg-white/5 backdrop-blur"
             data-map-card aria-label="Mapa com camadas temáticas">
          <!-- Placeholder visual do mapa (mantém estética enquanto o mapa real não é montado) -->
          <svg viewBox="0 0 1200 700" class="w-full h-[360px] sm:h-[420px]" role="img" aria-label="Mapa da região selecionada">
            <defs>
              <linearGradient id="mp-g1" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#E6F4F5"/><stop offset="1" stop-color="#ffffff"/>
              </linearGradient>
            </defs>
            <rect width="1200" height="700" fill="url(#mp-g1)"></rect>
            <g opacity="0.25" stroke="#0A5C67" stroke-width="2" fill="none">
              <path d="M100 160 C 300 140, 420 160, 620 210 S 920 300, 1100 240"/>
              <path d="M80 360 C 260 300, 460 360, 660 330 S 920 320, 1120 360"/>
              <path d="M120 520 C 300 500, 520 560, 740 520 S 980 480, 1100 520"/>
            </g>
            <g fill="#0A5C67">
              <circle cx="240" cy="210" r="8"/><circle cx="560" cy="230" r="8"/><circle cx="820" cy="270" r="8"/><circle cx="1020" cy="240" r="8"/>
              <circle cx="380" cy="360" r="8"/><circle cx="680" cy="340" r="8"/><circle cx="940" cy="360" r="8"/><circle cx="520" cy="540" r="8"/>
            </g>
          </svg>
        </div>
        <!-- legenda curta do mapa (opcional) -->
        <p class="mt-3 text-xs text-gray-500 dark:text-gray-400">
          <span class="font-medium" data-i18n="Map.legend">Legenda:</span>
          <span data-i18n="Map.legend_text">Linhas indicam iso-curvas e os pontos marcam estações/locais de referência.</span>
        </p>
      </div>

      <!-- card de séries (sparkline + valores) -->
      <div class="lg:col-span-4">
        <div class="rounded-3xl ring-1 ring-black/5 dark:ring-white/10 bg-white/60 dark:bg-white/5 backdrop-blur p-5"
             data-series-card>
          <h3 class="font-semibold text-[#031E21] dark:text-white mb-3" data-i18n="Map.series_title">Tendência (7 dias)</h3>

          <div class="space-y-4">
            <!-- item -->
            <div class="flex items-center justify-between gap-3">
              <div class="min-w-24">
                <p class="text-sm text-gray-500 dark:text-gray-400" data-i18n="Map.metric_precip">Precipitação</p>
                <p class="text-base font-semibold text-[#031E21] dark:text-white">
                  <span data-metric="precip">—</span> mm
                </p>
              </div>
              <svg viewBox="0 0 120 30" class="h-8 w-28" aria-hidden="true">
                <polyline fill="none" stroke="currentColor" stroke-width="2"
                  points="0,20 20,18 40,15 60,17 80,10 100,12 120,8"
                  class="text-[#0A5C67] dark:text-[#6BAAC9]"/>
              </svg>
            </div>

            <!-- item -->
            <div class="flex items-center justify-between gap-3">
              <div class="min-w-24">
                <p class="text-sm text-gray-500 dark:text-gray-400" data-i18n="Map.metric_flow">Vazão</p>
                <p class="text-base font-semibold text-[#031E21] dark:text-white">
                  <span data-metric="flow">—</span> m³/s
                </p>
              </div>
              <svg viewBox="0 0 120 30" class="h-8 w-28" aria-hidden="true">
                <polyline fill="none" stroke="currentColor" stroke-width="2"
                  points="0,12 20,15 40,14 60,10 80,12 100,18 120,20"
                  class="text-[#0A5C67] dark:text-[#6BAAC9]"/>
              </svg>
            </div>

            <!-- item -->
            <div class="flex items-center justify-between gap-3">
              <div class="min-w-24">
                <p class="text-sm text-gray-500 dark:text-gray-400" data-i18n="Map.metric_storage">Armazenamento</p>
                <p class="text-base font-semibold text-[#031E21] dark:text-white">
                  <span data-metric="storage">—</span> %
                </p>
              </div>
              <svg viewBox="0 0 120 30" class="h-8 w-28" aria-hidden="true">
                <polyline fill="none" stroke="currentColor" stroke-width="2"
                  points="0,16 20,12 40,10 60,12 80,14 100,12 120,8"
                  class="text-[#0A5C67] dark:text-[#6BAAC9]"/>
              </svg>
            </div>
          </div>

          <p class="mt-3 text-xs text-gray-500 dark:text-gray-400" data-i18n="Map.series_hint">
            As mini-curvas mostram a tendência dos últimos 7 dias; o número ao lado é o valor mais recente.
          </p>

          <a href="/dashboard/"
             class="mt-6 inline-flex items-center justify-center w-full rounded-xl px-4 py-2 font-semibold
                    bg-[#0A5C67] text-white hover:brightness-110"
             data-i18n="Map.cta">Abrir no Dashboard</a>
        </div>
      </div>
    </div>
  </div>
</section>
